{"version":3,"sources":["aoi.factory.js","panel.factory.js","prod.controller.js","prodchart.controller.js","prodheader.controller.js","stocker.factory.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"prod.js","sourcesContent":["app.factory('Aoi', [\r\n    \"$q\",\"IaCore\",\r\n    function($q, IaCore){\r\n    var timeout = 10;\r\n    var runinng = false;\r\n    var result;\r\n    var httpget;\r\n\r\n    var interfaz = {};\r\n    interfaz.info = function (aoibarcode,scope) {\r\n        result = $q.defer();\r\n        if(!runinng)\r\n        {\r\n            runinng = true;\r\n            httpget = IaCore.http({\r\n                url: 'prod/info/'+aoibarcode+'?filter=1&allstocker=1',\r\n                method: 'GET',\r\n                timeout: timeout\r\n            });\r\n\r\n            httpget.result.promise.then(function(data) {\r\n                runinng = false;\r\n                result.resolve(data);\r\n            },function(error) {\r\n                runinng = false;\r\n                result.reject(error);\r\n            });\r\n        }\r\n        return result.promise;\r\n    };\r\n\r\n    interfaz.rerun = function()\r\n    {\r\n        runinng = false;\r\n    };\r\n\r\n    interfaz.cancel = function() {\r\n        httpget.cancel();\r\n    };\r\n\r\n    return interfaz;\r\n}]);","app.factory('Panel',function() {\r\n    var panel_barcode_length = 10;\r\n    var panelsony_barcode_length = 19;\r\n\r\n    var interfaz = {};\r\n\r\n    interfaz.valid = function(panelbarcode) {\r\n        if (panelbarcode) {\r\n            if (\r\n                $.isNumeric(panelbarcode)\r\n                &&\r\n                (\r\n                    panelbarcode.length == panel_barcode_length ||\r\n                    panelbarcode.length == panelsony_barcode_length\r\n                )\r\n            ) {\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        } else {\r\n            return false;\r\n        }\r\n    };\r\n\r\n    return interfaz;\r\n});\r\n","app.controller(\"prodController\",\r\n    [\"$scope\",\"$rootScope\",\"$http\",\"$timeout\",\"$interval\", \"IaCore\", \"Aoi\", \"Stocker\", \"Panel\", \"toasty\", \"cfpLoadingBar\",\r\n    function($scope,$rootScope,$http,$timeout,$interval, IaCore, Aoi, Stocker, Panel, toasty, cfpLoadingBar) {\r\n    $rootScope.configprod = {\r\n        aoibarcode : IaCore.storage({name:'aoibarcode'}),\r\n        socketio: ':8080'\r\n    };\r\n\r\n    $rootScope.aoiService = {};\r\n    $rootScope.stockerService = {};\r\n    $rootScope.userService = {};\r\n\r\n    $rootScope.printError = function(title,result,modal)\r\n    {\r\n        if(result.error!=undefined) { result = result.error; }\r\n\r\n        if(result) {\r\n            switch (modal) {\r\n                case 'modal':\r\n                    IaCore.modalError($scope, result);\r\n                    break;\r\n                default:\r\n                    toasty.error({\r\n                        title: title,\r\n                        msg: result,\r\n                        timeout: 5000\r\n                    });\r\n                    break;\r\n            }\r\n        }\r\n    };\r\n\r\n    var socket = io.connect($rootScope.configprod.socketio);\r\n\r\n    socket.on('connect_error', function(){\r\n        toasty.error({\r\n            title: \"Produccion\",\r\n            msg: \"Error de conexion, servidor caido\",\r\n            timeout: 5000\r\n        });\r\n        $scope.$apply();\r\n    });\r\n\r\n    socket.on('disconnect', function () {\r\n        toasty.warning({\r\n            title: \"Produccion\",\r\n            msg: \"Conexion finalizada\"\r\n        });\r\n\r\n        $scope.$apply();\r\n    });\r\n\r\n    socket.on('connect', function(){\r\n        socket.emit('produccion', $rootScope.configprod.aoibarcode);\r\n\r\n        toasty.success({\r\n            title: \"Produccion\",\r\n            msg: \"Descargando informacion\"\r\n        });\r\n\r\n        $scope.$apply();\r\n    });\r\n\r\n    socket.on('waitForGetProduction', function () {\r\n        cfpLoadingBar.start();\r\n        $scope.$apply();\r\n    });\r\n\r\n    Stocker.nodeInit(socket);\r\n\r\n    socket.on('getProduccionResponse', function (data) {\r\n        $rootScope.aoiService = data;\r\n\r\n        if(data.produccion.inspector!= undefined)\r\n        {\r\n            $rootScope.userService = data.produccion.inspector;\r\n        } else\r\n        {\r\n            $rootScope.userService = null;\r\n        }\r\n\r\n        if(data.error==undefined) {\r\n            $rootScope.aoiService = data;\r\n\r\n            try\r\n            {\r\n                $rootScope.renderPeriodChart();\r\n            } catch (err)\r\n            {\r\n                console.error(err);\r\n            }\r\n\r\n            if(data.produccion) {\r\n                $rootScope.stockerService.stocker = data.produccion.stocker;\r\n                Stocker.autoscroll($rootScope.stockerService.stocker.paneles);\r\n                /*if(data.produccion.stocker.barcode)\r\n                {\r\n                    socket.emit('stockerInfo',data.produccion.stocker.barcode);\r\n                }*/\r\n            }\r\n        }\r\n\r\n        cfpLoadingBar.complete();\r\n\r\n        $rootScope.$digest();\r\n\r\n//        $scope.$apply();\r\n    });\r\n\r\n    socket.on('getProduccionResponseError', function (message) {\r\n        toasty.error({\r\n            title: \"Produccion\",\r\n            msg: \"Error: \"+message\r\n        });\r\n\r\n        cfpLoadingBar.complete();\r\n        $scope.$apply();\r\n    });\r\n\r\n    $rootScope.restartAoiData = function(changeAoi)\r\n    {\r\n        if(changeAoi!=undefined)\r\n        {\r\n            IaCore.storage({\r\n                name: 'aoibarcode',\r\n                value: changeAoi\r\n            });\r\n            $rootScope.configprod.aoibarcode = changeAoi;\r\n        }\r\n\r\n        $rootScope.aoiService = {};\r\n        $rootScope.stockerService = {};\r\n        $rootScope.userService = {};\r\n\r\n        socket.emit('produccion', $rootScope.configprod.aoibarcode);\r\n    };\r\n\r\n    var onScanner = $rootScope.$on('scannerEvent:enter',function(event,data) {\r\n        $rootScope.UserScanned(data.value);\r\n        Stocker.add(data.value);\r\n        Stocker.panelAdd(data.value);\r\n    });\r\n\r\n    $rootScope.UserScanned = function(scannedValue) {\r\n        // ENVIA EL BARCODE\r\n        if(\r\n            (\r\n                scannedValue.indexOf(\"LOGIN\") === 0 ||\r\n                scannedValue.indexOf(\"DLOGIN\") === 0\r\n            ) &&\r\n            scannedValue.length > 5 &&\r\n            $rootScope.aoiService.produccion.barcode\r\n        ) {\r\n            var userId = scannedValue.match( /\\d+/ );\r\n            if(userId)\r\n            {\r\n                userId = userId[0];\r\n            }\r\n\r\n            var userBarcode = scannedValue.replace(\"DLOGIN\", \"\").replace(\"LOGIN\", \"\");\r\n            var userName = userBarcode.replace(userId, \"\");\r\n\r\n            toasty.info({\r\n                title: \"Inspector\",\r\n                msg: \"Buscando datos de inspector\",\r\n                timeout: 5000\r\n            });\r\n\r\n            var credentials = {\r\n                name : userName,\r\n                userid : userId,\r\n                aoibarcode: $rootScope.aoiService.produccion.barcode\r\n            };\r\n\r\n            $http({method:'POST',url:'prod/user/login',params:credentials})\r\n            .then(function(result) {\r\n                result = result.data;\r\n                if(result) {\r\n                    if(result.error) {\r\n                        $rootScope.printError('Stocker',result,'modal');\r\n                    } else {\r\n                        toasty.success({\r\n                            title: \"Inspector\",\r\n                            msg: \"Operacion completa\",\r\n                            timeout: 5000\r\n                        });\r\n\r\n                        $rootScope.userService = result;\r\n\r\n                        $timeout(function() {\r\n                            //window.location.reload();\r\n                        },2000);\r\n                    }\r\n                }\r\n            }, function (error) {\r\n                if(error) {\r\n                    if(error.error != undefined) { error = error.error; }\r\n                    toasty.error({\r\n                        title: \"Atencion\",\r\n                        msg: error,\r\n                        timeout: 5000\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    };\r\n}]);\r\n","app.controller(\"prodChartController\",[\r\n    \"$rootScope\",\r\n    function($rootScope) {\r\n    $rootScope.renderPeriodChart = function()\r\n    {\r\n        if($rootScope.aoiService.produccion.period!=undefined)\r\n        {\r\n            var allOp = $rootScope.aoiService.produccion.period.map(function(obj) { return obj.op; });\r\n            var opserie = allOp.filter(function(v,i) { return allOp.indexOf(v) == i; });\r\n\r\n            $.each(opserie,function(index, op)\r\n            {\r\n                var points = $rootScope.aoiService.produccion.period.filter(function(obj,index) {\r\n                    if(obj.op==op)\r\n                    {\r\n                        return obj;\r\n                    }\r\n                });\r\n\r\n                var serieData = [];\r\n                $.each(points,function(index, p)\r\n                {\r\n                    var now = new Date();\r\n                    serieData.push([Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), p.periodo.split(':')[0]), p.total]);\r\n                });\r\n\r\n                // Verifica si ya se creo la serie en el chart\r\n                var mapSeries = prodchart.series.map(function(obj){ return obj.name; });\r\n                var serieindex = mapSeries.indexOf(op);\r\n\r\n                // La serie no exite, se crea con sus datos adjuntos\r\n                if(serieindex<0)\r\n                {\r\n                    prodchart.addSeries({\r\n                        name: op,\r\n                        data: serieData\r\n                    });\r\n                } else\r\n                {\r\n                    //              var lastcolor = prodchart.series[serieindex].color;\r\n                    //                prodchart.series[serieindex].remove();\r\n                    // La serie existe, actualizo datos\r\n                    prodchart.series[serieindex].setData(serieData);\r\n                    /*prodchart.addSeries({\r\n                     name: op,\r\n                     color: lastcolor,\r\n                     data: serieData\r\n                     });*/\r\n                }\r\n\r\n                /* prodchart.addSeries({\r\n                 name: op,\r\n                 color: lastcolor,\r\n                 data: serieData\r\n                 });*/\r\n            });\r\n        }\r\n    }\r\n}]);\r\n","app.controller(\"prodHeaderController\",[\r\n    \"$scope\", \"$rootScope\", \"IaCore\",\r\n    function($scope, $rootScope , IaCore) {\r\n\r\n    $scope.promptAoiSet = function(route)\r\n    {\r\n        IaCore.modal({\r\n            scope: $scope,\r\n            route:route,\r\n            title: 'AOI en produccion',\r\n            type: 'primary',\r\n            controller: 'promptAoiSetController'\r\n        });\r\n    };\r\n\r\n    $scope.btnFormSelectOp = function(route)\r\n    {\r\n        if(!$rootScope.btnFormSelectOpProccessing)\r\n        {\r\n            $rootScope.btnFormSelectOpProccessing = true;\r\n\r\n            IaCore.modal({\r\n                scope: $scope,\r\n                route: route,\r\n                title: 'Informacion de OP',\r\n                type: 'primary',\r\n                controller: 'btnFormSelectOpController'\r\n            });\r\n        }\r\n    };\r\n\r\n    $scope.promptStockerSet = function(route)\r\n    {\r\n        IaCore.modal({\r\n            scope: $scope,\r\n            route:route,\r\n            title: 'Nuevo stocker',\r\n            type: 'info',\r\n            controller: 'promptStockerSetController'\r\n        });\r\n    };\r\n\r\n    $scope.promptStockerAddPanel = function(route)\r\n    {\r\n        IaCore.modal({\r\n            scope: $scope,\r\n            route:route,\r\n            title: 'Asignar panel a stocker',\r\n            type: 'warning',\r\n            controller: 'promptStockerAddPanelController'\r\n        });\r\n    };\r\n\r\n    $scope.promptStockerReset = function(route)\r\n    {\r\n        IaCore.modal({\r\n            scope: $scope,\r\n            route:route,\r\n            title: 'Liberar stocker',\r\n            type: 'success',\r\n            controller: 'promptStockerRemoveController'\r\n        });\r\n    };\r\n\r\n    $scope.promptStockerRemovePanel = function(route)\r\n    {\r\n        IaCore.modal({\r\n            scope: $scope,\r\n            route:route,\r\n            title: 'Remover panel de stocker',\r\n            type: 'danger',\r\n            controller: 'promptStockerRemovePanelController'\r\n        });\r\n    };\r\n}]);\r\n\r\n// STOCKER\r\napp.controller(\"promptStockerSetController\",[\r\n    \"$scope\", \"$rootScope\", \"$timeout\", \"Stocker\",\r\n    function($scope, $rootScope, $timeout, Stocker) {\r\n    var onHide = $rootScope.$on(\"modal:hide\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = true;\r\n        });\r\n        onHide(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    var onShow = $rootScope.$on(\"modal:show\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = false;\r\n        });\r\n        onShow(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    $scope.$on(\"prompt:enter\",function(event,modal)\r\n    {\r\n        Stocker.add(modal.prompt_value);\r\n        modal.dialog.close();\r\n    });\r\n}]);\r\n\r\napp.controller(\"promptStockerRemoveController\",[\r\n    \"$scope\", \"$rootScope\", \"$timeout\", \"Stocker\",\r\n    function($scope, $rootScope, $timeout, Stocker) {\r\n    var onHide = $rootScope.$on(\"modal:hide\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = true;\r\n        });\r\n        onHide(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    var onShow = $rootScope.$on(\"modal:show\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = false;\r\n        });\r\n        onShow(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    $scope.$on(\"prompt:enter\",function(event,modal)\r\n    {\r\n        Stocker.remove(modal.prompt_value);\r\n        modal.dialog.close();\r\n    });\r\n}]);\r\n\r\n// PANEL\r\napp.controller(\"promptStockerAddPanelController\",[\r\n    \"$scope\", \"$rootScope\", \"$timeout\", \"Stocker\",\r\n    function($scope, $rootScope, $timeout, Stocker) {\r\n    var onHide = $rootScope.$on(\"modal:hide\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = true;\r\n        });\r\n        onHide(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    var onShow = $rootScope.$on(\"modal:show\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = false;\r\n        });\r\n        onShow(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    $scope.$on(\"prompt:enter\",function(event,modal)\r\n    {\r\n        Stocker.panelAdd(modal.prompt_value);\r\n        modal.dialog.close();\r\n    });\r\n}]);\r\n\r\napp.controller(\"promptStockerRemovePanelController\",[\r\n    \"$scope\", \"$rootScope\", \"$timeout\", \"Stocker\",\r\n    function($scope, $rootScope, $timeout, Stocker) {\r\n    var onHide = $rootScope.$on(\"modal:hide\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = true;\r\n        });\r\n        onHide(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    var onShow = $rootScope.$on(\"modal:show\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = false;\r\n        });\r\n        onShow(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    $scope.$on(\"prompt:enter\",function(event,modal)\r\n    {\r\n        Stocker.panelRemove(modal.prompt_value);\r\n        modal.dialog.close();\r\n    });\r\n}]);\r\n\r\n// AOI\r\napp.controller(\"promptAoiSetController\",[\r\n    \"$scope\", \"$rootScope\", \"$timeout\", \"IaCore\", \"Aoi\",\r\n    function($scope, $rootScope, $timeout, IaCore, Aoi) {\r\n    var onHide = $rootScope.$on(\"modal:hide\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = true;\r\n        });\r\n        onHide(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    var onShow = $rootScope.$on(\"modal:show\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = false;\r\n        });\r\n        onShow(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    $scope.$on(\"prompt:enter\",function(event,modal)\r\n    {\r\n        $rootScope.restartAoiData(modal.prompt_value);\r\n        modal.dialog.close();\r\n    });\r\n}]);\r\n\r\napp.controller(\"btnFormSelectOpController\",[\r\n    \"$scope\", \"$rootScope\", \"$timeout\", \"IaCore\", \"Aoi\",\r\n    function($scope, $rootScope, $timeout, IaCore, Aoi) {\r\n    var onHide = $rootScope.$on(\"modal:hide\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = true;\r\n            $rootScope.btnFormSelectOpProccessing = false;\r\n\r\n        });\r\n        onHide(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n\r\n    var onShow = $rootScope.$on(\"modal:show\",function(event,modal)\r\n    {\r\n        $timeout(function() {\r\n            $rootScope.scannerListener = false;\r\n            $rootScope.btnFormSelectOpProccessing = false;\r\n        });\r\n        onShow(); // Es necesario volver a llamar el metodo, para destruirlo\r\n    });\r\n}]);\r\n\r\n","app.factory('Stocker',[\r\n    \"$q\", \"$rootScope\", \"IaCore\", \"toasty\", \"Panel\",\r\n    function($q, $rootScope, IaCore, toasty, Panel) {\r\n    var socket;\r\n\r\n    var barcode_length = 8;\r\n\r\n    var strStartsWith = function (str, prefix) {\r\n        return str.indexOf(prefix) === 0;\r\n    };\r\n\r\n    var interfaz = {};\r\n\r\n    interfaz.autoscroll = function(pos) {\r\n        var container = $('#stocker_box div.panel_trace');\r\n        var scrollTo = $('#panel_'+pos);\r\n        if(scrollTo.offset()) {\r\n            container.animate({\r\n                scrollTop: scrollTo.offset().top - container.offset().top + container.scrollTop()\r\n            });\r\n        }\r\n    };\r\n\r\n    interfaz.nodeInit = function(_socket)\r\n    {\r\n        socket = _socket;\r\n\r\n        socket.on('stockerDeclaredResponse', function (result,toastId) {\r\n            toasty.clear(toastId);\r\n\r\n            if(result) {\r\n                if(result.error) {\r\n                    console.log('Error',result);\r\n                } else {\r\n                    $rootScope.stockerService = result;\r\n                    interfaz.autoscroll($rootScope.stockerService.stocker.paneles);\r\n                }\r\n            }\r\n            $rootScope.$digest();\r\n        });\r\n\r\n        socket.on('stockerInfoResponse', function (result,toastId) {\r\n            toasty.clear(toastId);\r\n\r\n            if(result) {\r\n                if(result.error) {\r\n                    console.log('Error',result);\r\n                } else {\r\n                    $rootScope.stockerService = result;\r\n                    interfaz.autoscroll($rootScope.stockerService.stocker.paneles);\r\n                }\r\n            }\r\n            $rootScope.$digest();\r\n        });\r\n\r\n        socket.on('stockerAddResponse', function (result,toastId) {\r\n            toasty.clear(toastId);\r\n\r\n            if(result) {\r\n                if(result.error) {\r\n                    $rootScope.printError('Stocker',result,'modal');\r\n                } else {\r\n                    toasty.success({\r\n                        title: \"Stocker\",\r\n                        msg: \"Agregado correctamente\",\r\n                        timeout: 2000\r\n                    });\r\n\r\n                    $rootScope.stockerService = result;\r\n                }\r\n            }\r\n            $rootScope.$digest();\r\n        });\r\n\r\n        socket.on('stockerRemoveResponse', function (result,toastId) {\r\n            toasty.clear(toastId);\r\n\r\n            if(result) {\r\n                if(result.error) {\r\n                    $rootScope.printError('Stocker',result,'modal');\r\n                } else {\r\n                    toasty.success({\r\n                        title: \"Stocker\",\r\n                        msg: \"Libreado correctamente\",\r\n                        timeout: 2000\r\n                    });\r\n\r\n                    $rootScope.stockerService = {};\r\n                }\r\n            }\r\n            $rootScope.$digest();\r\n        });\r\n\r\n        socket.on('panelAddResponse', function (result,toastId) {\r\n            toasty.clear(toastId);\r\n\r\n            if(result) {\r\n                if(result.error) {\r\n                    $rootScope.printError('Panel',result,'modal');\r\n                } else {\r\n                    toasty.success({\r\n                        title: \"Panel\",\r\n                        msg: \"Agregado correctamente\",\r\n                        timeout: 2000\r\n                    });\r\n\r\n                    $rootScope.stockerService.stocker = result;\r\n                }\r\n            }\r\n            $rootScope.$digest();\r\n        });\r\n\r\n        socket.on('panelRemoveResponse', function (result,toastId) {\r\n            toasty.clear(toastId);\r\n\r\n            if(result) {\r\n                if(result.error) {\r\n                    $rootScope.printError('Panel',result,'modal');\r\n                } else {\r\n                    toasty.success({\r\n                        title: \"Panel\",\r\n                        msg: \"Removido correctamente\",\r\n                        timeout: 2000\r\n                    });\r\n\r\n                    $rootScope.stockerService.stocker = result;\r\n                }\r\n            }\r\n            $rootScope.$digest();\r\n        });\r\n    };\r\n\r\n\r\n\r\n    interfaz.valid = function(stkbarcode) {\r\n        if(stkbarcode) {\r\n            if(\r\n                strStartsWith(stkbarcode.toUpperCase(),'STK') &&\r\n                stkbarcode.length==barcode_length\r\n            ) {\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        } else {\r\n            return false;\r\n        }\r\n    };\r\n\r\n    interfaz.add = function(stkbarcode) {\r\n        stkbarcode = stkbarcode.toUpperCase();\r\n        if (interfaz.valid(stkbarcode)) {\r\n            toasty.wait({\r\n                title: \"Stocker\",\r\n                msg: \"Agregando stocker a produccion\",\r\n                timeout: false,\r\n                onAdd: function(){\r\n                    socket.emit('stockerAdd',stkbarcode,this.id);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    interfaz.remove = function(stkbarcode) {\r\n        stkbarcode = stkbarcode.toUpperCase();\r\n        if (interfaz.valid(stkbarcode)) {\r\n            toasty.wait({\r\n                title: \"Stocker\",\r\n                msg: \"Liberando de produccion\",\r\n                timeout: false,\r\n                onAdd: function(){\r\n                    socket.emit('stockerRemove',stkbarcode,this.id);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    interfaz.panelAdd = function(panelbarcode) {\r\n        if(Panel.valid(panelbarcode)) {\r\n            toasty.wait({\r\n                title: \"Panel\",\r\n                msg: \"Agregando panel al stocker\",\r\n                timeout: false,\r\n                onAdd: function(){\r\n                    socket.emit('panelAdd',panelbarcode,this.id);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    interfaz.panelRemove = function(panelbarcode) {\r\n        if(Panel.valid(panelbarcode)) {\r\n            toasty.wait({\r\n                title: \"Panel\",\r\n                msg: \"Removiendo panel de stocker\",\r\n                timeout: false,\r\n                onAdd: function(){\r\n                    socket.emit('panelRemove',panelbarcode,this.id);\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    return interfaz;\r\n}]);\r\n"]}